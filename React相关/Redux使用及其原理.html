<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redux 使用及其原理 | Lexmin0412 Blog</title>
    <meta name="description" content="All I know is that I know nothing.">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.5a9f4582.css" as="style"><link rel="preload" href="/blog/assets/js/app.f9d0cd31.js" as="script"><link rel="preload" href="/blog/assets/js/40.abb46576.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.e1014028.js"><link rel="prefetch" href="/blog/assets/js/11.e1a433c1.js"><link rel="prefetch" href="/blog/assets/js/12.e4dc21a7.js"><link rel="prefetch" href="/blog/assets/js/13.2ff5ea6b.js"><link rel="prefetch" href="/blog/assets/js/14.f5e34f38.js"><link rel="prefetch" href="/blog/assets/js/15.04692b7e.js"><link rel="prefetch" href="/blog/assets/js/16.b5b8df8e.js"><link rel="prefetch" href="/blog/assets/js/17.f8a37333.js"><link rel="prefetch" href="/blog/assets/js/18.15241e5a.js"><link rel="prefetch" href="/blog/assets/js/19.38e794bc.js"><link rel="prefetch" href="/blog/assets/js/2.55bdad76.js"><link rel="prefetch" href="/blog/assets/js/20.b0842c38.js"><link rel="prefetch" href="/blog/assets/js/21.66b3d57a.js"><link rel="prefetch" href="/blog/assets/js/22.1a131c39.js"><link rel="prefetch" href="/blog/assets/js/23.2cdd89f2.js"><link rel="prefetch" href="/blog/assets/js/24.289082cc.js"><link rel="prefetch" href="/blog/assets/js/25.30199399.js"><link rel="prefetch" href="/blog/assets/js/26.4ed9f824.js"><link rel="prefetch" href="/blog/assets/js/27.648f6ceb.js"><link rel="prefetch" href="/blog/assets/js/28.5c9f2c98.js"><link rel="prefetch" href="/blog/assets/js/29.25525a5b.js"><link rel="prefetch" href="/blog/assets/js/3.bb35268b.js"><link rel="prefetch" href="/blog/assets/js/30.6da6cd79.js"><link rel="prefetch" href="/blog/assets/js/31.e7a1d7e7.js"><link rel="prefetch" href="/blog/assets/js/32.aa89ef5d.js"><link rel="prefetch" href="/blog/assets/js/33.9e5f2ade.js"><link rel="prefetch" href="/blog/assets/js/34.0e78326d.js"><link rel="prefetch" href="/blog/assets/js/35.e07d154a.js"><link rel="prefetch" href="/blog/assets/js/36.9f2516da.js"><link rel="prefetch" href="/blog/assets/js/37.58114411.js"><link rel="prefetch" href="/blog/assets/js/38.2101d6e4.js"><link rel="prefetch" href="/blog/assets/js/39.abb50c4b.js"><link rel="prefetch" href="/blog/assets/js/4.e01a7ed0.js"><link rel="prefetch" href="/blog/assets/js/41.376be89f.js"><link rel="prefetch" href="/blog/assets/js/42.5a68a6c2.js"><link rel="prefetch" href="/blog/assets/js/43.21fa8ca5.js"><link rel="prefetch" href="/blog/assets/js/44.c04b68a8.js"><link rel="prefetch" href="/blog/assets/js/45.1503a593.js"><link rel="prefetch" href="/blog/assets/js/46.6c4a34de.js"><link rel="prefetch" href="/blog/assets/js/47.10175fbf.js"><link rel="prefetch" href="/blog/assets/js/48.6884408d.js"><link rel="prefetch" href="/blog/assets/js/49.d1758d5b.js"><link rel="prefetch" href="/blog/assets/js/5.5d5cc51d.js"><link rel="prefetch" href="/blog/assets/js/50.4fd7ddcf.js"><link rel="prefetch" href="/blog/assets/js/51.0bb083cf.js"><link rel="prefetch" href="/blog/assets/js/52.84983fa0.js"><link rel="prefetch" href="/blog/assets/js/53.e9195172.js"><link rel="prefetch" href="/blog/assets/js/54.e42d6291.js"><link rel="prefetch" href="/blog/assets/js/55.4584372d.js"><link rel="prefetch" href="/blog/assets/js/56.a0aa2e45.js"><link rel="prefetch" href="/blog/assets/js/57.ce5d8f6b.js"><link rel="prefetch" href="/blog/assets/js/58.2ea76020.js"><link rel="prefetch" href="/blog/assets/js/59.32460686.js"><link rel="prefetch" href="/blog/assets/js/6.4084156f.js"><link rel="prefetch" href="/blog/assets/js/60.13aaa8cd.js"><link rel="prefetch" href="/blog/assets/js/61.7a0ddaed.js"><link rel="prefetch" href="/blog/assets/js/62.2f8f9469.js"><link rel="prefetch" href="/blog/assets/js/63.47291a06.js"><link rel="prefetch" href="/blog/assets/js/64.6368c377.js"><link rel="prefetch" href="/blog/assets/js/65.97d69368.js"><link rel="prefetch" href="/blog/assets/js/66.ea36399a.js"><link rel="prefetch" href="/blog/assets/js/67.965c4521.js"><link rel="prefetch" href="/blog/assets/js/68.61ea255f.js"><link rel="prefetch" href="/blog/assets/js/69.67064acc.js"><link rel="prefetch" href="/blog/assets/js/7.a1d1965f.js"><link rel="prefetch" href="/blog/assets/js/70.e6763c29.js"><link rel="prefetch" href="/blog/assets/js/71.b3c1ffc3.js"><link rel="prefetch" href="/blog/assets/js/72.b54eb881.js"><link rel="prefetch" href="/blog/assets/js/73.d281738f.js"><link rel="prefetch" href="/blog/assets/js/74.0fc144d3.js"><link rel="prefetch" href="/blog/assets/js/75.4cc76cbd.js"><link rel="prefetch" href="/blog/assets/js/76.57b2353d.js"><link rel="prefetch" href="/blog/assets/js/77.27dc4aaf.js"><link rel="prefetch" href="/blog/assets/js/78.da61e210.js"><link rel="prefetch" href="/blog/assets/js/79.e3cf1b50.js"><link rel="prefetch" href="/blog/assets/js/8.08778254.js"><link rel="prefetch" href="/blog/assets/js/80.6b841a2c.js"><link rel="prefetch" href="/blog/assets/js/81.2576b432.js"><link rel="prefetch" href="/blog/assets/js/82.0558f439.js"><link rel="prefetch" href="/blog/assets/js/83.2de4491b.js"><link rel="prefetch" href="/blog/assets/js/84.b4973fad.js"><link rel="prefetch" href="/blog/assets/js/85.06916dbf.js"><link rel="prefetch" href="/blog/assets/js/86.d41e0214.js"><link rel="prefetch" href="/blog/assets/js/87.ffef960d.js"><link rel="prefetch" href="/blog/assets/js/88.9a5d9e9a.js"><link rel="prefetch" href="/blog/assets/js/89.bdc296c8.js"><link rel="prefetch" href="/blog/assets/js/9.9e89e6d0.js"><link rel="prefetch" href="/blog/assets/js/90.b782f445.js"><link rel="prefetch" href="/blog/assets/js/91.c1f1a4f6.js"><link rel="prefetch" href="/blog/assets/js/92.980abb99.js"><link rel="prefetch" href="/blog/assets/js/93.ba666301.js"><link rel="prefetch" href="/blog/assets/js/94.b83cbe23.js"><link rel="prefetch" href="/blog/assets/js/95.ba3151e2.js"><link rel="prefetch" href="/blog/assets/js/96.d2b3081f.js"><link rel="prefetch" href="/blog/assets/js/97.ba64a24c.js"><link rel="prefetch" href="/blog/assets/js/98.96b80839.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.5a9f4582.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Lexmin0412 Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://lexmin0412.github.io/tarox-blog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Taro X Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/lexmin0412/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://lexmin0412.github.io/tarox-blog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Taro X Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/lexmin0412/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>回顾与展望</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/点滴/2021年中总结.html" class="sidebar-link">2021 年中总结</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>React</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/React相关/React Hooks.html" class="sidebar-link">React Hooks</a></li><li><a href="/blog/React相关/React组件跨层级通信之Context.html" class="sidebar-link">React组件跨层级通信 - Context</a></li><li><a href="/blog/React相关/React高阶组件-HOC.html" class="sidebar-link">React高阶组件 - HOC</a></li><li><a href="/blog/React相关/Redux使用及其原理.html" class="active sidebar-link">Redux 使用及其原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#redux-使用" class="sidebar-link">Redux 使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#api" class="sidebar-link">API</a></li><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#使用示例" class="sidebar-link">使用示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#异步" class="sidebar-link">异步</a></li><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#函数式编程" class="sidebar-link">函数式编程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#合成" class="sidebar-link">合成</a></li><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#柯里化" class="sidebar-link">柯里化</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#实现一个简单的-redux" class="sidebar-link">实现一个简单的 redux</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#入口文件：" class="sidebar-link">入口文件：</a></li><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#applymiddleware-js" class="sidebar-link">applyMiddleware.js</a></li><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#createstore-js" class="sidebar-link">createStore.js</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#react-redux" class="sidebar-link">React-Redux</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#为什么要使用-react-redux" class="sidebar-link">为什么要使用 React-Redux?</a></li><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#class-使用示例" class="sidebar-link">Class 使用示例</a></li><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#hook-使用示例" class="sidebar-link">Hook 使用示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#实现一个简单的-react-redux" class="sidebar-link">实现一个简单的 React Redux</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#provider" class="sidebar-link">Provider</a></li><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#connect" class="sidebar-link">connect</a></li><li class="sidebar-sub-header"><a href="/blog/React相关/Redux使用及其原理.html#hook-实现" class="sidebar-link">Hook 实现</a></li></ul></li></ul></li><li><a href="/blog/React相关/使用React Portal实现一个通知栏组件.html" class="sidebar-link">使用 React Portal 实现一个通知栏组件</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Taro</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/Taro/Taro踩坑指南.html" class="sidebar-link">Taro踩坑指南</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>小程序</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/小程序/微信小程序获取经纬度不准确的解决方案.html" class="sidebar-link">微信小程序获取经纬度不准确的解决方案</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>H5开发</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/H5开发/H5定位终极解决方案.html" class="sidebar-link">H5定位终极解决方案</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>编码规范</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/编码规范/Taro项目规范.html" class="sidebar-link">Taro项目规范</a></li><li><a href="/blog/编码规范/commitlint钩子配置.html" class="sidebar-link">CommitLint钩子配置</a></li><li><a href="/blog/编码规范/editorconfig配置.html" class="sidebar-link">editorconfig配置</a></li><li><a href="/blog/编码规范/规范工具收集.html" class="sidebar-link">规范工具收集</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>前端工程化</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/前端工程化/Gitlab_Tag创建规范.html" class="sidebar-link">Gitlab Tag创建规范</a></li><li><a href="/blog/前端工程化/Gitlab_协作开发流程.html" class="sidebar-link">Gitlab协作开发流程</a></li><li><a href="/blog/前端工程化/taro多端项目搭建.html" class="sidebar-link">基于Taro+TypeScript的多端项目搭建</a></li><li><a href="/blog/前端工程化/taro小程序mobx项目搭建.html" class="sidebar-link">taro小程序mobx项目搭建</a></li><li><a href="/blog/前端工程化/使用Github Actions自动化构建项目.html" class="sidebar-link">使用 Github Actions 实现前端应用部署及 npm 包发布自动化</a></li><li><a href="/blog/前端工程化/使用rollup构建Javascript库.html" class="sidebar-link">使用rollup构建Javascript库</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/JavaScript/JavaScript中的this、call、apply.html" class="sidebar-link">JavaScript中的this、call、apply</a></li><li><a href="/blog/JavaScript/数组方法.html" class="sidebar-link">JavaScript 数组方法大全</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>VSCode</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/VSCode/VSCode插件开发.html" class="sidebar-link">VSCode插件开发指南</a></li><li><a href="/blog/VSCode/vscode扩展.html" class="sidebar-link">VSCode扩展集合</a></li><li><a href="/blog/VSCode/使用setting sync同步vscode设置.html" class="sidebar-link">使用setting sync同步vscode设置</a></li><li><a href="/blog/VSCode/VSCode快捷键.html" class="sidebar-link">VSCode 快捷键</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>app交互</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/app交互/app webview中富文本超链接点击无反应的解决方案.html" class="sidebar-link">app webview中富文本超链接点击无反应的解决方案</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>npm相关</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/npm相关/npm发布node包指北.html" class="sidebar-link">发布npm包步骤</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>博客部署</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/博客部署/vuepress部署博客.html" class="sidebar-link">vuepress部署博客</a></li><li><a href="/blog/博客部署/docsify和vercel搭建博客.html" class="sidebar-link">从 0 开始基于 docsify + vercel + github 搭建属于自己的博客</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/其他/前端代码审查清单.html" class="sidebar-link">front-end-code-checklist</a></li><li><a href="/blog/其他/前端开发环境搭建.html" class="sidebar-link">前端开发环境搭建</a></li><li><a href="/blog/tools/常用网站.html" class="sidebar-link">常用网站</a></li><li><a href="/blog/tools/chrome插件.html" class="sidebar-link">Chrome 插件</a></li><li><a href="/blog/其他/HTTP请求状态码.html" class="sidebar-link">HTTP响应状态码</a></li><li><a href="/blog/其他/mac操作指南.html" class="sidebar-link">Mac操作指南</a></li><li><a href="/blog/其他/ssh多配置共存.html" class="sidebar-link">ssh 多配置共存</a></li><li><a href="/blog/其他/全栈图谱.html" class="sidebar-link">全栈图谱</a></li><li><a href="/blog/其他/前端技术栈.html" class="sidebar-link">前端技术栈</a></li><li><a href="/blog/其他/工具箱.html" class="sidebar-link">工具箱</a></li><li><a href="/blog/其他/移动端兼容性问题解决方案.html" class="sidebar-link">移动端兼容性问题解决方案</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="redux-使用及其原理"><a href="#redux-使用及其原理" aria-hidden="true" class="header-anchor">#</a> Redux 使用及其原理</h1> <h2 id="redux-使用"><a href="#redux-使用" aria-hidden="true" class="header-anchor">#</a> Redux 使用</h2> <p>Redux 是 javascript 应用的状态容器，它保证了程序行为的一致性，且便于测试。</p> <h3 id="api"><a href="#api" aria-hidden="true" class="header-anchor">#</a> API</h3> <h4 id="createstore"><a href="#createstore" aria-hidden="true" class="header-anchor">#</a> createStore</h4> <p>创建 store，用于存储状态(state)</p> <h4 id="getstate"><a href="#getstate" aria-hidden="true" class="header-anchor">#</a> getState</h4> <p>获取状态，无参数，返回当前state</p> <h4 id="dispatch"><a href="#dispatch" aria-hidden="true" class="header-anchor">#</a> dispatch</h4> <p>提交更新, 参数为一个action</p> <h4 id="reducer"><a href="#reducer" aria-hidden="true" class="header-anchor">#</a> reducer</h4> <p>初始化、修改状态函数（纯函数），接受当前 state 和 action 为参数，返回新的state</p> <p>示例：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token parameter">prevState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> newState
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>之所以将这种函数称为 reducer，是因为它与被传入 <code>Array.prototype.reduce(reducer, ?initialValue)</code> 的回调函数属于相同的类型。保持 reducer 纯净非常重要，永远不要在 reducer 中做下面这些操作：</p> <ul><li>修改传入参数</li> <li>执行有副作用的操作，如 API 请求和路由跳转</li> <li>调用非纯函数，如 <code>Date.now()</code> 或者 <code>Math.random()</code></li></ul> <h4 id="subscribe"><a href="#subscribe" aria-hidden="true" class="header-anchor">#</a> subscribe</h4> <p>订阅状态，参数为一个监听函数，在 store 发生变化后执行</p> <h3 id="使用示例"><a href="#使用示例" aria-hidden="true" class="header-anchor">#</a> 使用示例</h3> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>

<span class="token comment">/**
 * reducer 接收一个state和action，返回新的state
 */</span>
<span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 初始化状态</span>
	count<span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">switch</span><span class="token punctuation">(</span> action<span class="token punctuation">.</span>type <span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> <span class="token string">'INCREMENT'</span><span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token punctuation">{</span>
				count<span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
			<span class="token punctuation">}</span>
		<span class="token keyword">case</span> <span class="token string">'DECREMENT'</span><span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token punctuation">{</span>
				count<span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">-</span> <span class="token number">1</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token operator">:</span>
			<span class="token keyword">return</span> state
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用 createStore 创建一个状态容器</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>

<span class="token comment">// 导出状态集，用于组件订阅</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> store
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// ReduxDemo.js</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./../store/index'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">reduxDemo</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>

	<span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 订阅</span>
		store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token comment">// store状态更新后，需要触发页面render，页面状态才会更新</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">forceUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'into redux demo render'</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
				</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>  <span class="token punctuation">{</span>
          <span class="token comment">// 提交更新, 所有对state的更改都经由dispatch(action)提交</span>
          store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'DECREMENT'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">-</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
				</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
					margin<span class="token operator">:</span> <span class="token string">'0 20px'</span>
				<span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
				</span><span class="token punctuation">{</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token plain-text">
				</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
				</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'INCREMENT'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
			</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="异步"><a href="#异步" aria-hidden="true" class="header-anchor">#</a> 异步</h2> <p>Redux 只是一个纯粹的状态管理器，默认只支持同步，要实现异步任务，比如延迟，网络请求，需要中间件的支持，比如我们使用的最简单的 redux-thunk 和 redux-logger。</p> <p>中间件就是一个函数，对 <code>store.dispatch</code> 方法进行改造，在发出 <code>Action</code> 和执行 Reducer 这两步之间，添加了其他功能。</p> <p>Redux 本来不支持异步，它的 dispatch 方法的 action 参数只支持 plain object，也就是 <code>{type: 'INCREMENT'}</code> 类似的形式，无法执行异步逻辑，使用如下：</p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token function-variable function">handleAdd</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'INCREMENT'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> 

<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">add</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>而通过引入 redux-thunk 中间件，既不影响原生的 redux 调用方式，还可以实现向 dispatch 传递函数，从而执行异步逻辑：</p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token function-variable function">handleAdd</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'INCREMENT'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> 

<span class="token comment">// 模拟异步方式</span>
<span class="token function-variable function">handleAsyncAdd</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// thunk中间件会判断dispatch的参数类型，如果是函数则给它添加两个参数：dispatch和getState，</span>
	store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span> getState</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// 模拟请求</span>
			<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'INCREMENT'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">add</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleAsyncAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">async add</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>dispatch 接收的参数可以是一个 plain object, 也可以是一个函数，它接收 dispatch 和 getState 函数，dispatch 就是 redux 中的 store.dispatch 函数，而 getState 对应 redux 中的 getState,  返回修改前的 state。</p> <h2 id="函数式编程"><a href="#函数式编程" aria-hidden="true" class="header-anchor">#</a> 函数式编程</h2> <h3 id="概念"><a href="#概念" aria-hidden="true" class="header-anchor">#</a> 概念</h3> <p>函数式编程倡导 <strong>利用若干简单的执行单元</strong> 让计算结果不断渐进，逐层推导复杂的运算。</p> <p>函数式编程有两个最基本的运算：合成（compose）与柯里化（Currying）。</p> <h3 id="合成"><a href="#合成" aria-hidden="true" class="header-anchor">#</a> 合成</h3> <p>如果一个值要经过多个函数才能变成另一个值，就可以把所有中间步骤合并成一个函数，这叫做函数的合成（compose）。</p> <p>合成的可以使代码变得简单而富有可读性，同时通过不同的组合方式，我们可以轻松组合出其他函数，让我们的代码更具表现力。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> <span class="token function-variable function">fn1</span> <span class="token operator">=</span> <span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn1 arg'</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span>
	<span class="token keyword">return</span> arg
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">fn2</span> <span class="token operator">=</span> <span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn2 arg'</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span>
	<span class="token keyword">return</span> arg
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">fn3</span> <span class="token operator">=</span> <span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn3 arg'</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span>
	<span class="token keyword">return</span> arg
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">compose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">...</span>funcs<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span> funcs<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> args
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span> funcs<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> funcs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> funcs<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>fn1<span class="token punctuation">,</span> fn2<span class="token punctuation">,</span> fn3<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'hei'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="柯里化"><a href="#柯里化" aria-hidden="true" class="header-anchor">#</a> 柯里化</h3> <p>柯里化，是把接受多个参数的函数变换成接受一个单一参数的函数，并且返回接受余下的参数而且返回结果的新函数的技术。</p> <p>简而言之，就是把多参数函数转变成单参数函数。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token function-variable function">addY</span> <span class="token operator">=</span> <span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> x <span class="token operator">+</span> y
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> addY
<span class="token punctuation">}</span>

<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token function-variable function">addY</span> <span class="token operator">=</span> <span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> x <span class="token operator">+</span> y
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> addY
<span class="token punctuation">}</span>

<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="实现一个简单的-redux"><a href="#实现一个简单的-redux" aria-hidden="true" class="header-anchor">#</a> 实现一个简单的 redux</h2> <p>createStore 接收两个参数，第一个参数为 reducer，不必多说，第二个参数为 enhancer。</p> <h3 id="入口文件："><a href="#入口文件：" aria-hidden="true" class="header-anchor">#</a> 入口文件：</h3> <p>redux 向外暴露两个基础 API，一个 createStore, 另一个是 applyMiddleware，而 applyMiddleware 的调用结果是作为 createStore 的第二个参数。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">import</span> createStore <span class="token keyword">from</span> <span class="token string">'./createStore'</span>
<span class="token keyword">import</span> applyMiddleware <span class="token keyword">from</span> <span class="token string">'./applyMiddleware'</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span>
	createStore<span class="token punctuation">,</span>
	applyMiddleware
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="applymiddleware-js"><a href="#applymiddleware-js" aria-hidden="true" class="header-anchor">#</a> <code>applyMiddleware.js</code></h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// applyMiddleware.js</span>
<span class="token keyword">import</span> compose <span class="token keyword">from</span> <span class="token string">'./../utils/compose'</span>

<span class="token comment">/**
 * applyMiddleware的作用是强化dispatch，而不改变其他api(getState和subscribe)
 * 它的执行结果需要作为createStore方法的第二个参数
 * 所以它需要返回一个函数，接收createStore为参数，然后对其的dispatch方法进行扩展后返回
 * 这个函数的返回结果也是一个函数，接收reducer作为参数，返回扩展后的store
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">applyMiddleware</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>middlewares</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

	<span class="token keyword">return</span> <span class="token parameter">createStore</span> <span class="token operator">=&gt;</span> <span class="token parameter">reducer</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>
		<span class="token keyword">let</span> dispatch <span class="token operator">=</span> store<span class="token punctuation">.</span>dispatch

		<span class="token comment">// 定义中间件需要的api</span>
		<span class="token keyword">const</span> middleAPI <span class="token operator">=</span> <span class="token punctuation">{</span>
			getState<span class="token operator">:</span> store<span class="token punctuation">.</span>getState<span class="token punctuation">,</span>
			<span class="token function-variable function">dispatch</span><span class="token operator">:</span> <span class="token parameter">action</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 这里相当于就是将dispatch复制一份 防止不同的中间件之间互相冲突</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 给所有中间件传入getState和dispatch</span>
		<span class="token keyword">const</span> middlewareChain <span class="token operator">=</span> middlewares<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">middleware</span><span class="token operator">=&gt;</span><span class="token function">middleware</span><span class="token punctuation">(</span>middleAPI<span class="token punctuation">)</span><span class="token punctuation">)</span>

		<span class="token comment">// 融合所有函数，包装dispatch</span>
		dispatch <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token operator">...</span>middlewareChain<span class="token punctuation">)</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>dispatch<span class="token punctuation">)</span>

		<span class="token comment">// 返回 store，同时加强 dispatch</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			<span class="token operator">...</span>store<span class="token punctuation">,</span>
			dispatch
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> applyMiddleware

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h3 id="createstore-js"><a href="#createstore-js" aria-hidden="true" class="header-anchor">#</a> <code>createStore.js</code></h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * 创建store 接收参数：reducer和enhancer
 * @param {*} reducer 定义的state修改函数
 * @param {*} enhancer store包装，用于强化dispatch 返回一个函数，这个接收createStore为参数，并返回另一个函数，接收reducer为参数
 * @returns
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">createStore</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reducer<span class="token punctuation">,</span> enhancer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span> enhancer <span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">enhancer</span><span class="token punctuation">(</span>createStore<span class="token punctuation">)</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">let</span> currentState <span class="token operator">=</span> <span class="token punctuation">{</span>
		count<span class="token operator">:</span> <span class="token number">0</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">const</span> listeners <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

	<span class="token comment">// 获取当前状态</span>
	<span class="token keyword">const</span> <span class="token function-variable function">getState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> currentState
	<span class="token punctuation">}</span>

	<span class="token comment">// 接收一个action 触发reducer</span>
	<span class="token keyword">const</span> <span class="token function-variable function">dispatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dispatch'</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span>
		currentState <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span> currentState<span class="token punctuation">,</span> action<span class="token punctuation">)</span>
		listeners<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">callbackfn</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token function">callbackfn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 接收一个回调函数，在state更改时执行</span>
	<span class="token keyword">const</span> <span class="token function-variable function">subscribe</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">listener</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		listeners<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span>
		<span class="token comment">// 返回取消订阅的函数</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">const</span> index <span class="token operator">=</span> listeners<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span>
			listeners<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 手动执行dispatch，赋初始值</span>
	<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'FFFFFF'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		dispatch<span class="token punctuation">,</span>
		getState<span class="token punctuation">,</span>
		subscribe
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> createStore

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h2 id="react-redux"><a href="#react-redux" aria-hidden="true" class="header-anchor">#</a> React-Redux</h2> <h3 id="为什么要使用-react-redux"><a href="#为什么要使用-react-redux" aria-hidden="true" class="header-anchor">#</a> 为什么要使用 React-Redux?</h3> <p>每一个地方都要书写订阅、取消订阅的代码，都需要调用 <code>store.getState</code> 去使用 state，很繁琐。</p> <h3 id="class-使用示例"><a href="#class-使用示例" aria-hidden="true" class="header-anchor">#</a> Class 使用示例</h3> <h4 id="api-2"><a href="#api-2" aria-hidden="true" class="header-anchor">#</a> API</h4> <ul><li>Connect</li></ul> <h4 id="代码"><a href="#代码" aria-hidden="true" class="header-anchor">#</a> 代码</h4> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> bindActionCreators <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>

@<span class="token function">connect</span><span class="token punctuation">(</span>
	<span class="token comment">// mapStateToProps function</span>
	<span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>count<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token comment">// mapDispatchToProps:  object or function</span>
	<span class="token comment">// object</span>
	<span class="token comment">// {</span>
	<span class="token comment">// 	add: () =&gt; ({type: 'INCREMENT'})</span>
	<span class="token comment">// }</span>
	<span class="token comment">// function1</span>
	<span class="token comment">// dispatch =&gt; {</span>
	<span class="token comment">// 	return {</span>
	<span class="token comment">// 		dispatch,</span>
	<span class="token comment">// 		add: () =&gt; dispatch({type: 'INCREMENT'}),</span>
	<span class="token comment">// 		minus: () =&gt; dispatch({type: 'DECREMENT'})</span>
	<span class="token comment">// 	}</span>
	<span class="token comment">// }</span>
	<span class="token comment">// function2</span>
	<span class="token parameter">dispatch</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> actionCreator <span class="token operator">=</span> <span class="token punctuation">{</span>
			<span class="token function-variable function">add</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'INCREMENT'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token function-variable function">minus</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'DECREMENT'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">let</span> creators <span class="token operator">=</span> <span class="token function">bindActionCreators</span><span class="token punctuation">(</span>actionCreator<span class="token punctuation">,</span> dispatch<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			dispatch<span class="token punctuation">,</span>
			<span class="token operator">...</span>creators
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// merge props, 合并 props，可以用于隐藏或增加props</span>
	<span class="token punctuation">(</span><span class="token parameter">stateProps<span class="token punctuation">,</span> dispatchProps<span class="token punctuation">,</span> ownProps</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			<span class="token operator">...</span>stateProps<span class="token punctuation">,</span>
			<span class="token operator">...</span>dispatchProps<span class="token punctuation">,</span>
			<span class="token comment">// ...ownProps</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'this.props'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span>
		<span class="token keyword">const</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> add<span class="token punctuation">,</span> minus <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
		<span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
				Index
				</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">count: </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
				</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">add</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
				</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">minus</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
			</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Index

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><h3 id="hook-使用示例"><a href="#hook-使用示例" aria-hidden="true" class="header-anchor">#</a> Hook 使用示例</h3> <h4 id="api-3"><a href="#api-3" aria-hidden="true" class="header-anchor">#</a> API</h4> <ul><li>useSelector 获取 store state</li> <li>useDispatch 获取 dispatch</li></ul> <h4 id="示例："><a href="#示例：" aria-hidden="true" class="header-anchor">#</a> 示例：</h4> <p>函数组件使用：</p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useCallback <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useSelector<span class="token punctuation">,</span> useDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">HookIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>count<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> count <span class="token punctuation">}</span> <span class="token operator">=</span> store
  
  <span class="token comment">// 优化：使用useCallback缓存方法，防止每次渲染都重新定义</span>
  <span class="token keyword">const</span> add <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用dispatch</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'INCREMENT'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> <span class="token punctuation">(</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
			Hook Index
			</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
				</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text">
			</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
			</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'INCREMENT'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">add</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
			</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'DECREMENT'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">minus</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
		</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="实现一个简单的-react-redux"><a href="#实现一个简单的-react-redux" aria-hidden="true" class="header-anchor">#</a> 实现一个简单的 React Redux</h2> <p>在 React 应用中，需要使用 context 来实现全局数据绑定和获取，react-redux 要做的，就是在 redux 和 react 之间提供一种连接，本身不提供任何数据相关的逻辑。它需要实现的 API，一个用于在应用最顶层提供数据(Provider)，一个用于在深层组件中获取数据(connect)。另外，对于 hook 组件，还需要提供 store state 和 dispatch 方法的 hook 调用形式。</p> <h3 id="provider"><a href="#provider" aria-hidden="true" class="header-anchor">#</a> Provider</h3> <p>使用 React 的 context API 实现。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">const</span> StoreContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 定义用于传递store的context</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">Provider</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> children<span class="token punctuation">,</span> store <span class="token punctuation">}</span> <span class="token operator">=</span> props
	<span class="token keyword">return</span> <span class="token punctuation">(</span>
		<span class="token operator">&lt;</span>StoreContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>  <span class="token comment">// 将store传递给所有children组件</span>
			<span class="token punctuation">{</span>children<span class="token punctuation">}</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>StoreContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
	<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="connect"><a href="#connect" aria-hidden="true" class="header-anchor">#</a> connect</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 这个方法引用自redux, 也可以自己实现，其实就是将plain object形式的action转变为函数</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> bindActionCreators <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>

<span class="token comment">/**
 *
 * @param {*} mapStateToProps 状态映射
 * @param {*} mapDispatchToProps 派发状态映射
 * @returns
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">connect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">,</span> mapDispatchToProps<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token parameter">WrappedComponent</span>  <span class="token operator">=&gt;</span> <span class="token parameter">props</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// 给新返回的组件的props加上store state和dispatch，这个dispatch是指所有的派发状态方法</span>
	<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>StoreContext<span class="token punctuation">)</span>
	<span class="token keyword">const</span> stateProps <span class="token operator">=</span> <span class="token function">mapStateToProps</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  
	<span class="token keyword">let</span> dispatchProps <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">// 默认只有一个dispatch方法</span>
		dispatch<span class="token operator">:</span> store<span class="token punctuation">.</span>dispatch
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span> mapDispatchToProps <span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 判断如果是function则直接覆盖</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token keyword">typeof</span> mapDispatchToProps <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
			dispatchProps <span class="token operator">=</span> <span class="token function">mapDispatchToProps</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>dispatch<span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token keyword">typeof</span> mapDispatchToProps <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 如果是object则调用bindActionCreators转换</span>
			dispatchProps <span class="token operator">=</span> <span class="token function">bindActionCreators</span><span class="token punctuation">(</span>mapDispatchToProps<span class="token punctuation">,</span> store<span class="token punctuation">.</span>dispatch<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 函数组件中引起更新 在class中直接使用this.forceUpdate</span>
	<span class="token keyword">const</span> <span class="token punctuation">[</span>ignored<span class="token punctuation">,</span> forceUpdate<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token operator">=&gt;</span>x<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token comment">// 因为useEffect会在组件渲染完成之后执行，会有延迟，可能在这一段延迟范围内store改变了但是没有监听到，所以需要使用useLayoutEffect</span>
	<span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token function">forceUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			unsubscribe <span class="token operator">&amp;&amp;</span> <span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>store<span class="token punctuation">]</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// 将 props, stateProps, dispatchProps 全部合并传递到子组件，在子组件中可以通过this.props来访问store中的state和dispatch方法</span>
		<span class="token operator">&lt;</span>WrappedComponent
			<span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span>  <span class="token comment">// 输入组件原本的props</span>
			<span class="token punctuation">{</span><span class="token operator">...</span>stateProps<span class="token punctuation">}</span>  <span class="token comment">// 映射后的store状态</span>
			<span class="token punctuation">{</span><span class="token operator">...</span>dispatchProps<span class="token punctuation">}</span>  <span class="token comment">// 映射后的派发状态方法</span>
		<span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="hook-实现"><a href="#hook-实现" aria-hidden="true" class="header-anchor">#</a> Hook 实现</h3> <h4 id="useselector"><a href="#useselector" aria-hidden="true" class="header-anchor">#</a> useSelector</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * useSelector hook实现
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useSelector</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">mapStateToProps</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>StoreContext<span class="token punctuation">)</span>
	<span class="token keyword">const</span> nextStore <span class="token operator">=</span> <span class="token function">mapStateToProps</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token comment">// 更新 不添加这一段的话只能更新store，无法触发页面渲染</span>
	<span class="token comment">// 在这里定义的话，不论在哪里调用dispatch，修改完state之后都会更新这里</span>
	<span class="token keyword">const</span> <span class="token punctuation">[</span>ignored<span class="token punctuation">,</span> forceUpdate<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token operator">=&gt;</span>x<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token function">forceUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			unsubscribe <span class="token operator">&amp;&amp;</span> <span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>store<span class="token punctuation">]</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> nextStore
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="usedispatch"><a href="#usedispatch" aria-hidden="true" class="header-anchor">#</a> useDispatch</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * useDispatch方法实现
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useDispatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>StoreContext<span class="token punctuation">)</span>
	<span class="token keyword">return</span> store<span class="token punctuation">.</span>dispatch
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这样一来，就实现了 React-Redux 中的所有基础 API，可以看出并没有对 store 状态本身做任何处理，只是做了 Redux 和 React 的连接工作。</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/blog/assets/js/app.f9d0cd31.js" defer></script><script src="/blog/assets/js/40.abb46576.js" defer></script>
  </body>
</html>
